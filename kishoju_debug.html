<!DOCTYPE html>
<html>
    <head>
        <base target="_top">
        <title>輝晶獣分散支援ツール</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="src/control.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
        <script src="src/debug.js"></script>
        <link rel="manifest" href="manifest.json">
        <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
        <link rel="apple-touch-icon-precomposed" href="icon.png" size="152x152">
        <script  type="application/javascript">
            //Service Workerの読み込み
            if('serviceWorker' in navigator){
              navigator.serviceWorker
              .register('src/service-worker.js')
              .then(function(){
                console.log('Service Worker Registered');
              });
            }
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171127523-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-171127523-1');
        </script>

        <script type="text/Javascript">
        var objWd = $(window);              //ウィンドウ
        var l_rightFollowFlg = false;       //追随中フラグ

        //ウィンドウ - リサイズ／最大化
        objWd.on('resize maximize', function(){
            //サイドリストの高さ調整
            fncFixRedReSize();
        });
        //サイドリスト（右側固定時）の高さ設定
        function fncFixRedReSize(){
            if ( l_rightFollowFlg === true ){
                //高さ設定
                var h = objWd.height() - 470;
                //20以下には縮めない
                if ( h <= 20 ){ h = 20; }
                $('#fix-red').children('tbody').height(h);
            }
        }
        //jqイベント
        $(function(){
            //分散モード変更
            $('.setting-box .mode-change-box input[name=opt-tgl]').change(function(){
                modeChange();
            });
            //サイドリスト追随モード切替
            $('#chk-side-follow').click(function(){
                const MODE_ON = 'following-on';    //ついてくるClass名
                const MODE_OFF = 'following-off';  //ついてこないClass名
                //追随切替
                l_rightFollowFlg = $('#chk-side-follow').prop('checked');
                if ( l_rightFollowFlg === true ){
                    $('.side-list-box,.side-list-btn,.other_box').removeClass(MODE_OFF);
                    $('.side-list-box,.side-list-btn,.other_box').addClass(MODE_ON);
                    fncFixRedReSize();
                }else{
                    $('.side-list-box,.side-list-btn,.other_box').removeClass(MODE_ON);
                    $('.side-list-box,.side-list-btn,.other_box').addClass(MODE_OFF);
                }
            });
            //サイドリスト収納切替
            $('.side-list-btn').click(function(){
                $('.side-list-box').animate( { width: 'toggle' },'fast' );
                $(this).find('.hung-icon').toggleClass('rev');      //アイコン反転
            });
            //スライドBOX（使い方／更新履歴）開閉
            $('.slider-title').click(function(){
                $(this).next('.slider-box').slideToggle("fast");
                $(this).find('.slider-icon').toggleClass('rev');    //アイコン反転
            }).click();

            /*
                //情報提供モード切替
                $('#chk-send-info').click(function(){
                    var bFlg = $('#chk-send-info').prop('checked');
                    if ( bFlg === true ){
                        var msg = confirm("情報提供モードをONにすると「虹」「虹(赤)→黄」の遷移時間が「サーバー情報(虹黄)」ページに公開されます。ONにしてもよろしいですか？");
                        if( msg === false ){ return false; }
                        $('#chk-send-info').next('.btn-tgl').html('提供 ON');
                        localStorage.setItem("sendMode", "ON")
                    } else {
                        $('#chk-send-info').next('.btn-tgl').html('提供OFF');
                        localStorage.setItem("sendMode", "OFF")
                    }
                    setSendFlg(bFlg);
                });
            */
        });
        </script>
    </head>

    <body>
        !--<button onclick="debug()">debug</button>-->
        <!--ヘッダ-->
        <div style="display: block; margin-bottom: 15px; width: 100%;">
            <span style="font-size: 14px; font-weight: bold; text-decoration: underline dotted;">
                DQX - 輝晶獣分散支援ツール
            </span>
            <!--
                <span style="font-size: 14px;">｜</span>
                <span style="font-size: 12px;">
                    <a href="https://ouchi-dqx.github.io/Tools/YellowList.html">サーバー情報(虹黄)</a>
                    <!--情報提供ボタン--
                    <span class="chk-tgl-span">
                        <label><input type="checkbox" id="chk-send-info" autocomplete="off"><span class="btn-tgl">提供OFF</span></label>
                    </span>
                </span>
            -->
            <span style="font-size: 14px;">｜</span>
            <span style="font-size: 12px;">
                <a href="javascript:LoginCheck();">関係者向け</a>
            </span>
            <span style="font-size: 14px;">｜</span>
            <span style="font-size: 12px;">
                <a href="javascript:omikuji();">調査鯖おみくじ</a>
                <span class="omikuji"></span>
            </span>
            <span style="font-size: 14px;">｜</span>
            <span style="font-size: 12px;">
                <a href="javascript:getShortURL();">調査データをURL化</a>
            </span>
        </div>

        <div class="nowGetURL">
            <span style="font-size: 12px;">URLを取得中...</span>
        </div>
        <div class="ShortURL">
            <input type="text" class="URL">
            <button class="copyURL" onclick="copyURL()">コピー</button>
        </div>
        テスト中２。。。
        <div class="debugArea">
        </div>

        <div style="display: table; width: 100%; margin-bottom: 20px;">
            <div style="display: table-cell; width: 40px; text-align: left; vertical-align: top; color: dimgray;">
                <!--i class="material-icons" style="top: 3px;">house</i-->
                <img src="icon.png" width="25px" height="25px" style="margin-top: 5px;">
            </div>
            <div class="ouchi-msg">
                ◆スマホ版のテスト中　テスト協力いただけると嬉しいです。→
                <a href="https://ouchi-dqx.github.io/Tools/test/testphone.html">スマホ版(β2)</a><br />
                ◆鯖全体の現在時間を更新するボタンを追加しました。<a href="https://twitter.com/ouchi_dqx/status/1341416339643060226">(参考動画)</a><br />
                ◆調査データをURL化する機能がiOSで動かない？不具合を修正しました？
            </div>
        </div>

        <!--サーバーの設定-->
        <div class="setting-box">
            <div class="setting-title">
                <span>調査サーバー選択</span><span class="material-icons">play_arrow</span>
                <div class="mode-change-box">
                    <label><input type="radio" name="opt-tgl" value="PT4" autocomplete="off" checked><div class="btn-tgl">4人分散</div></label>
                    <label><input type="radio" name="opt-tgl" value="PT8" autocomplete="off"><div class="btn-tgl">8人分散</div></label>
                </div>
            </div>
            <div class="setting-btn-box" style="font-size: 15px;">
                <span class="select-mode PT4">
                    <button class="setServers" value="1" boxName="1 - 10">1 - 10</button>
                    <button class="setServers" value="11" boxName="11 - 20">11 - 20</button>
                    <button class="setServers" value="21" boxName="21 - 30">21 - 30</button>
                    <button class="setServers" value="31" boxName="31 - 40">31 - 40</button>
                    <button class="setServers" value="1" Start="9" End="10" boxName="1 - 10">9 - 10</button>
                </span>
                <span class="select-mode PT8">
                    <button class="setServers" value="1" Start="1" End="4" boxName="1 - 10">1 - 4</button>
                    <button class="setServers" value="1" Start="5" End="8" boxName="1 - 10">5 - 8</button>
                    <!--
                    <button class="setServers" value="1" Start="1" End="5" boxName="1 - 10">1 - 5</button>
                    <button class="setServers" value="1" Start="6" End="10" boxName="1 - 10">6 - 10</button>
                    -->
                    <button class="setServers" value="11" Start="11" End="15" boxName="11 - 20">11 - 15</button>
                    <button class="setServers" value="11" Start="16" End="20" boxName="11 - 20">16 - 20</button>
                    <button class="setServers" value="21" Start="21" End="25" boxName="21 - 30">21 - 25</button>
                    <button class="setServers" value="21" Start="26" End="30" boxName="21 - 30">26 - 30</button>
                    <button class="setServers" value="31" Start="31" End="35" boxName="31 - 40">31 - 35</button>
                    <button class="setServers" value="31" Start="36" End="40" boxName="31 - 40">36 - 40</button>
                </span>
            </div>
        </div>
        <!--調査状態の設定-->
        <div class="setting-box">
            <div class="setting-title">
                <span>調査状態の設定</span><span class="material-icons">play_arrow</span>
            </div>
            <div class="setting-btn-box">
                <button class="even_odd">標準モード</button>
                <button onclick="load_Storage()">前回の続きから</button>
                <button onclick="Cleaner(this)" value="all">すべて最初から</button>
                <button onclick="Cleaner(this)" value="input">今のリストを最初から</button>
            </div>
        </div>

        <!--サーバー一覧-->
        <table class="ServerList" id="" align="left" style="margin-right:10px;">
            <thead>
                <tr id="server-list-hd">
                    <td align="center" id="server-no-hd">
                        <div class="server-list-hd-text" style="width: 40px;">鯖</div>
                    </td>
                    <td align="center" class="ゲル">
                        <div class="server-list-hd-text" style="font-size: 12px;">ゲルヘナ</div>
                        <span class="server-list-hd-text">幻野</span>
                        <span style="float:left"><button class="left"><i class="material-icons arrow">skip_previous</i></button></span>
                        <span style="float:right"><button class="right"><i class="material-icons arrow">skip_next</i></button></span>
                    </td>
                    <td align="center" class="砂漠">
                        <div class="server-list-hd-text" style="font-size: 12px;">ジャリムバハ</div>
                        <span class="server-list-hd-text">砂漠</span>
                        <span style="float:left"><button class="left"><i class="material-icons arrow">skip_previous</i></button></span>
                        <span style="float:right"><button class="right"><i class="material-icons arrow">skip_next</i></button></span>
                    </td>
                    <td align="center" class="バル">
                        <div class="server-list-hd-text" style="font-size: 12px;">バルディア</div>
                        <span class="server-list-hd-text">山岳</span>
                        <span style="float:left"><button class="left"><i class="material-icons arrow">skip_previous</i></button></span>
                        <span style="float:right"><button class="right"><i class="material-icons arrow">skip_next</i></button></span>
                    </td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!--サイドリスト-->
        <div class="side-list-box following-off" style="display: table;">
            <div class="chk-tgl-box">
                <label>
                    <input type="checkbox" id="chk-side-follow" autocomplete="off">
                    <div class="btn-tgl"><i class="material-icons" style="top: 4px; font-size: 16px;">push_pin</i>右サイドに固定</div>
                </label>
            </div>
            <div class="function-btn-box">
                <button id="btn-save" onclick="save_Storage()"><i class="material-icons" style="top: 5px;">save</i>保存</button>
                <button id="btn-rollback" onclick="Rollback()"><i class="material-icons" style="top: 6px;">undo</i>戻す</button>
            </div>

            <table id="fix-blue" class="fix_blue" style="margin-bottom: 3px;">
                <thead>
                    <tr><th>青黄リスト(赤時間)</th></tr>
                </thead>
                <tbody>
                    <!-- tbody -->
                </tbody>
            </table>
            <div class="function-btn-box-mini">
                <button onclick="setClip(this)" value="fix_blue">コピー</button>
                <button onclick="Cleaner(this)" value="fix_blue">クリア</button>
            </div>

            <table id="fix-red" class="fix_red" style="margin-bottom: 3px;">
                <thead>
                    <tr><th>確定リスト</th></tr>
                </thead>
                <tbody>
                    <!-- tbody -->
                </tbody>
            </table>
            <div class="function-btn-box-mini">
                <button onclick="setClip(this)" value="fix_red">コピー</button>
                <button onclick="Cleaner(this)" value="fix_red">クリア</button>
            </div>

            <div class="side-list-add-box">
                <span>
                    ｻｰﾊﾞｰ <input type="number" id="Server" min="1" max="40" value="1" style="width: 40px;">
                </span>
                <span>
                    <select id="Point">
                        <option>ゲル</option>
                        <option>砂漠</option>
                        <option>バル</option>
                    </select>
                </span>
                <br />
                <input id="sTime" style="width: 40px;" placeholder="時:分">-<input id="eTime" style="width: 40px;" placeholder="時:分">
                <button onclick="push_fix()">追加</button>
            </div>

            <div class="other_box">
                <table id="other_fix_red" class="other_fix_red" style="margin-bottom: 3px;">
                    <thead class="other_fix_red_head">
                        <tr><th>外部確定リスト</th></tr>
                    </thead>
                    <tbody>
                        <!-- tbody -->
                    </tbody>
                </table>
                <div class="other_block">
                    <textarea class="push_fixs"></textarea>

                    <div class="function-btn-box-mini">
                        <button onclick="pushFixs()">追加</button>
                        <button onclick="setClip(this)" value="other_fix_red">コピー</button>
                        <button onclick="Cleaner(this)" value="other_fix_red">クリア</button>
                    </div>
                </div>
            </div>

        </div>
        <!--ハンガーボタン-->
        <div class="side-list-btn following-off">
            <i class="material-icons hung-icon" style="font-size: 50px; font-size: 30px;">exit_to_app</i>
        </div>

        <div style="clear: both;"></div>

        <div class="slider-title">
            使い方<i class="material-icons slider-icon">publish</i>
        </div>
        <div class="slider-box">
            <ul class="box-list">
                <li><b>【Step1】[調査サーバー選択]で担当するサーバーグループを選択します。</b></li>
                <li><b>【Step2】[調査状態の設定]でデータの復旧／クリアを行います。</b><br />
                    　<span class="text-btn" style="padding: 1px 5px;">前回の続きから</span>：保存された入力状態を復元します<br />
                    　<span class="text-btn" style="padding: 1px 5px;">すべて最初から</span>：保存されている情報をすべてクリアします<br />
                    　<span class="text-btn" style="padding: 1px 5px;">今のリストを最初から</span>：表示中のチェックリストだけをクリアします<br />
                </li>
                <li>
                    <b>【Step3】チェックリスト ヘッダの</b>
                    <span class="text-btn"><i class="material-icons arrow" style="font-size: 18px; line-height: 12px; top: 5px;">skip_previous</i></span>
                    <span class="text-btn"><i class="material-icons arrow" style="font-size: 18px; line-height: 12px; top: 5px;">skip_next</i></span>
                    <b>で調査場所を巡回順に並び替えます。</b>
                </li>
                <li>
                    <span class="text-btn"><i class="material-icons arrow" style="font-size: 18px; line-height: 12px; top: 5px;">autorenew</i></span>
                    ：その鯖のゲル・砂漠・バルの現在時間を更新します。(青黄、赤、前回赤or虹+今回黄を除く)<br />
                    　青～虹のボタンを押すのと同じ処理をゲル・砂漠・バル一括で行います。
                    　<a href="https://twitter.com/ouchi_dqx/status/1341416339643060226">(参考動画)</a>
                </li>
                <li>
                    [調査データをURL化]：その鯖の調査データをURL化します。<br />
                    URLを開く事で作成した時の調査データを他人が利用することができます。
                </li>
                <li><span class="text-btn"><i class="material-icons arrow" style="font-size: 18px; line-height: 12px; top: 5px;">save</i>保存</span>
                    ：入力情報（メモ欄など）を保存します。
                    時間情報はカラーボタンをクリックすることで自動的に保存されていきますので、こまめにこのボタンで保存する必要はありません。
                </li>
                <li><span class="text-btn"><i class="material-icons arrow" style="font-size: 18px; line-height: 12px; top: 5px;">undo</i>戻す</span>：チェックリストを1操作前の状態に戻します。最大5回まで。</li>
                <li><span class="text-ylist">青黄リスト(赤時間)</span><span class="text-rlist">確定リスト</span><span class="text-rlist">外部確定リスト</span>はチェックリスト入力時に自動的に追加されます。<br />
                    <span class="text-rlist">確定リスト</span><span class="text-rlist">外部確定リスト</span>は手入力も可能です。<br />
                    <span class="text-rlist">確定リスト</span>：サーバー番号、調査場所、時間を入力して<span class="text-btn">追加</span>をクリックします。<br />
                    <span class="text-rlist">外部確定リスト</span>：<span class="text-rlist">外部確定リスト</span>をクリックし表示された入力欄に<br />
                    　　　　　　　　　本ツールを利用してコピーされたリストを入力して<span class="text-btn">追加</span>をクリックします。<br />
                </li>
                <li><span class="text-btn">コピー</span>：<span class="text-ylist">青黄</span><span class="text-rlist">確定</span>の全体をクリップボードにコピーします。</li>
                <li><span class="text-btn">クリア</span>：<span class="text-ylist">青黄</span><span class="text-rlist">確定</span>の全体をクリアします。1行だけ削除する場合は対象の行をクリックします。</li>
                <li>使用イメージ動画は<a href="https://twitter.com/ouchi_dqx/status/1271044499561570307">こちら</a></li>
            </ul>
        </div>

        <div class="slider-title">
            更新履歴<i class="material-icons slider-icon">publish</i>
        </div>
        <div class="slider-box">
            <ul class="box-list">
                <li>2021/01/10 <br />
                    ・調査データをURL化する機能がiOSで動かない？不具合を修正しました？
                </li>
                <li>2020/12/23 <br />
                    ・調査データを短縮URL化する機能について、bit.lyに短縮サービスを変更しました。
                </li>
                <li>2020/12/22 <br />
                    ・鯖全体の時間を更新するボタン機能で<br />
                    　前回赤or虹・今回黄の時前回時間が更新されてしまう不具合を修正しました。
                </li>
                <li>2020/12/18 <br />
                    ・調査データをURL化する機能を追加しました。<br />
                    　青黄・確定以外の情報も全て他人に渡すことができます。
                </li>
                <li>2020/12/14 <br />
                    ・鯖全体の時間を更新するボタンを追加しました。<br />
                    　青黄・赤以外の場所を全て更新します。<br />
                    ・iOSで青木・確定リストの確定リストをクリックしても反応しない不具合を修正しました？
                </li>
                <li>2020/12/01 <br />
                    ・虹黄情報共通ツールを封印しました。
                </li>
                <li>2020/11/15 <br />
                    ・青黄リスト関連の不具合を2件修正しました。
                        ①青→黄→黄変化後、戻るボタンを押すと青黄が二重登録される不具合
                        ②青→黄変化後、戻るボタンを押しても青黄リストから消えない不具合を修正
                </li>
                <li>2020/10/16 <br />
                    ・2垢用に[偶数奇数モード]を追加しました。(要望)<br />
                    　標準では[標準モード]で[偶数奇数モード]にするとサーバ番号の並びが偶数奇数になります。<br />
                    　(4人分散モード時のみ)
                </li>
                <li>2020/10/08 <br />
                    ・黄→赤変化時、前回から1時間経過していた場合は前回時間を削除するようにしました(要望)
                </li>
                <li>2020/10/05 <br />
                    ・青→黄変化時、一定時間経過後に自動で前回・今回時間を更新するようにしました。(要望)<br />
                    ・[戻す]ボタンで前回・今回時間が正常に巻き戻らない不具合を修正しました。<br />
                    ・赤or虹→黄色変化時、一定時間経過してもテキストが消えない不具合を修正しました？
                </li>
                <li>2020/10/02 <br />
                    虹黄情報共有ツールを復活させました。<br />
                    デフォルトでは虹黄情報を提供しないようになっています。([提供OFF／ON]で切替)
                </li>
                <li>2020/10/02以前の変更は<a href="https://twitter.com/ouchi_dqx/status/1271044499561570307">こちら</a></li>
            </ul>
        </div>

        <div style="font-size: 13px; margin-top: 30px;">
            ■ 本ツールは <a href="https://kouseidq10.com/tools/bunsan">輝晶獣分散狩り支援ページ</a> 様の機能を参考に、独自で作成・拡張したものです。<br/>
            ■ 本ツールには「虹」「虹(赤)→黄」遷移時間を収集・公開する機能がありますが<br />
            　 情報提供は任意としています。その他の調査情報の取得は一切行っておりません。<br />
            ■ <a href="https://ouchi-dqx.github.io/Tools/kishoju_phone.html">スマホ版(β)</a><br />
            ■ 動作ブラウザ：Chrome／FireFox／MS Edge。※IEでは動きません。<br />
            ■ 要望・不具合報告等は<a href="https://twitter.com/ouchi_dqx">こちら</a>まで。
        </div>

        <template id="template1">
            <tr class="Servers">
                <td class="Server">
                    <div class="ServerID">サーバー</div>
                    <button class="btn_all"><i class="material-icons" style="font-size: 15px;">autorenew</i></button>
                </td>
                <td class="ゲル">
                    <div class="setTemp"></div>
                </td>
                <td class="砂漠">
                    <div class="setTemp"></div>
                </td>
                <td class="バル">
                    <div class="setTemp"></div>
                </td>
            </tr>
        </template>

        <template id="template2">
            <div class="template2-box">
                <div class="btn-box">
                    <button class="btn" value="skyblue">青</button>
                    <button class="btn" value="yellow">黄</button>
                    <button class="btn" value="red">赤</button>
                    <button class="btn" value="violet">虹</button>
                </div>
                <div class="bef-box" style=" margin:3px auto;">
                    <p class="time-title">前回</p>
                    <p class="befTime" color="" Date="" style="background-color: transparent;"></p>
                </div>
                <div class="now-box" style=" margin:3px auto;">
                    <p class="time-title">現在</p>
                    <p class="nowTime" color="" Date="" style="background-color: transparent;"></p>
                </div>
                <div class="memo" color="" Date="">

                </div>
                <input type="text" class="memo2" placeholder="メモ欄">
            </div>
        </template>
    </body>
</html>